<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="google-site-verification" content="XY_Df8ypC1IlrIbuwUjIjdFXsVXKzQ6uSsnDmR5allU" />
  <title>CalorieFlow | Smart Calorie & Diet Calculator</title>
  <meta
    name="description"
    content="CalorieFlow is a smart calorie calculator that helps you estimate your daily calorie needs, macros and meal split based on your gender, age, height, weight and activity level."
  />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Favicon -->
  <link rel="icon" href="logo.png.png" type="image/png" />
  <link rel="shortcut icon" href="logo.png.png" type="image/png" />

  <!-- Google Font -->
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg-gradient-start: #f2e9ff;
      --bg-gradient-end: #e0f3ff;
      --card-bg: #ffffff;
      --card-bg-soft: rgba(255, 255, 255, 0.92);
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --error: #dc2626;
      --border: #e5e7eb;
      --radius-lg: 24px;
      --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.20);
    }

    body.dark-mode {
      --card-bg: #020617;
      --card-bg-soft: rgba(2, 6, 23, 0.96);
      --accent: #0ea5e9;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border: #1f2937;
      --shadow-soft: 0 28px 70px rgba(15, 23, 42, 0.9);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 32px 24px;
      color: var(--text-main);
      background: radial-gradient(circle at top, #f97316 0, transparent 60%),
        radial-gradient(circle at bottom, #0ea5e9 0, transparent 55%),
        linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url("background.png") center / cover no-repeat fixed;
      filter: blur(6px) brightness(0.85);
      opacity: 0.65;
      z-index: -2;
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.50),
        rgba(15, 23, 42, 0.25),
        rgba(15, 23, 42, 0.65)
      );
      z-index: -1;
      pointer-events: none;
    }

    body.dark-mode::after {
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.35), transparent 55%),
        radial-gradient(circle at bottom, rgba(251, 191, 36, 0.25), transparent 55%),
        linear-gradient(to bottom, #020617, #020617);
      opacity: 0.95;
    }

    .app-container {
      width: 100%;
      max-width: 1120px;
      background: var(--card-bg-soft);
      border-radius: 32px;
      box-shadow: var(--shadow-soft);
      padding: 24px 24px 26px;
      backdrop-filter: blur(26px);
      border: 1px solid rgba(148, 163, 184, 0.28);
    }

    body.dark-mode .app-container {
      border-color: rgba(15, 23, 42, 0.9);
    }

    header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
    }

    header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      margin-bottom: 6px;
    }

    header p {
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    .app-logo {
      width: 64px;
      height: 64px;
      object-fit: contain;
      border-radius: 999px;
      border: 2px solid rgba(148, 163, 184, 0.35);
      margin-bottom: 10px;
      background: rgba(248, 250, 252, 0.9);
    }

    .theme-toggle-wrapper {
      position: absolute;
      top: 0;
      right: 0;
    }

    .theme-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(248, 250, 252, 0.9);
      cursor: pointer;
      font-size: 0.8rem;
      color: #111827;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.15);
    }

    .theme-toggle span.icon {
      font-size: 1rem;
    }

    body.dark-mode .theme-toggle {
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      border-color: rgba(31, 41, 55, 0.9);
    }

    .calculator-card {
      background: var(--card-bg);
      border-radius: 26px;
      padding: 22px 20px 20px;
      display: grid;
      grid-template-columns: 1.08fr 0.92fr;
      gap: 22px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    @media (max-width: 900px) {
      .calculator-card {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 18px 12px;
      }

      .app-container {
        padding: 18px 14px 20px;
        border-radius: 22px;
      }

      .calculator-card {
        padding: 16px 12px 14px;
      }
    }

    .form-section {
      border-right: 1px solid var(--border);
      padding-right: 18px;
    }

    @media (max-width: 900px) {
      .form-section {
        border-right: none;
        border-bottom: 1px solid var(--border);
        padding-right: 0;
        padding-bottom: 16px;
        margin-bottom: 8px;
      }
    }

    .results-section {
      display: flex;
      flex-direction: column;
      gap: 14px;
      justify-content: center;
    }

    .section-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 14px;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.88rem;
    }

    label {
      font-weight: 500;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 9px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.85rem;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease, transform 0.08s ease,
        background 0.2s ease, color 0.2s ease;
      background: #f9fafb;
      color: var(--text-main);
    }

    input[type="number"]:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #ffffff;
      transform: translateY(-1px);
    }

    input[type="number"]::placeholder {
      color: #9ca3af;
      font-size: 0.8rem;
    }

    body.dark-mode input[type="number"],
    body.dark-mode select {
      background: #020617;
      color: var(--text-main);
      border-color: #1f2937;
    }

    .inline-options {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .chip-option {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.8rem;
      cursor: pointer;
      background: #f9fafb;
      transition: border 0.2s ease, background 0.2s ease, transform 0.08s ease,
        box-shadow 0.2s ease;
    }

    .chip-option input {
      accent-color: var(--accent);
      cursor: pointer;
    }

    .chip-option:hover {
      border-color: var(--accent-soft);
      background: #ffffff;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);
    }

    body.dark-mode .chip-option {
      background: #020617;
    }

    .btn-primary {
      margin-top: 10px;
      width: 100%;
      padding: 11px 14px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #ffffff;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: background 0.18s ease, transform 0.08s ease, box-shadow 0.18s ease;
      box-shadow: 0 10px 24px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:hover {
      background: #1d4ed8;
      transform: translateY(-1px) scale(1.01);
      box-shadow: 0 14px 30px rgba(37, 99, 235, 0.45);
    }

    body.dark-mode .btn-primary {
      box-shadow: 0 13px 30px rgba(14, 165, 233, 0.55);
    }

    body.dark-mode .btn-primary:hover {
      background: #0ea5e9;
      box-shadow: 0 16px 36px rgba(14, 165, 233, 0.7);
    }

    .btn-primary:active {
      transform: translateY(0) scale(0.99);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
    }

    .btn-primary span.icon {
      font-size: 1.1rem;
      line-height: 1;
    }

    /* ÿ≤ÿ± ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸäŸäŸÜ */
    .btn-secondary {
      margin-top: 8px;
      width: 100%;
      padding: 9px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-muted);
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease,
        transform 0.08s ease;
    }

    .btn-secondary:hover {
      background: rgba(148, 163, 184, 0.1);
      color: var(--text-main);
      border-color: var(--accent-soft);
      transform: translateY(-1px);
    }

    body.dark-mode .btn-secondary {
      background: transparent;
      color: var(--text-muted);
      border-color: #1f2937;
    }

    body.dark-mode .btn-secondary:hover {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      border-color: #334155;
    }

    .error-message {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--error);
      background: #fee2e2;
      border-radius: 999px;
      padding: 6px 10px;
      display: none;
    }

    .result-box {
      border-radius: 20px;
      border: 1px dashed var(--accent-soft);
      background: #f9fafb;
      padding: 14px 14px;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.25s ease, transform 0.25s ease;
      font-size: 0.9rem;
    }

    body.dark-mode .result-box {
      background: #020617;
    }

    .result-box.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .result-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      font-size: 0.7rem;
      font-weight: 500;
      color: #1d4ed8;
      margin-bottom: 6px;
    }

    body.dark-mode .result-tag {
      color: #0ea5e9;
    }

    .result-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      font-size: 0.88rem;
    }

    .result-label {
      color: var(--text-muted);
    }

    .result-value {
      font-weight: 600;
    }

    .result-note {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
      font-size: 0.87rem;
    }

    @media (max-width: 1100px) {
      .results-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .results-grid {
        grid-template-columns: 1fr;
      }
    }

    .result-card {
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(248, 250, 252, 0.7);
      padding: 10px 11px;
    }

    body.dark-mode .result-card {
      background: rgba(15, 23, 42, 0.95);
      border-color: #1f2937;
    }

    .result-card-title {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .result-large {
      font-size: 1rem;
      font-weight: 600;
    }

    .macro-range {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .split-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-bottom: 3px;
    }

    .split-row span:last-child {
      font-weight: 500;
    }

    /* SHARE SECTION */
    .share-section {
      margin-top: 18px;
      background: var(--card-bg);
      border-radius: 22px;
      padding: 14px 16px 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: grid;
      gap: 8px;
    }

    .share-title {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .share-text {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .share-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .share-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(248, 250, 252, 0.95);
      font-size: 0.82rem;
      cursor: pointer;
      text-decoration: none;
      color: var(--text-main);
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease;
    }

    .share-btn:hover {
      background: #eef2ff;
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
    }

    .share-btn span.icon {
      font-size: 1rem;
    }

    body.dark-mode .share-section {
      background: #020617;
      border-color: #020617;
    }

    body.dark-mode .share-btn {
      background: #020617;
      border-color: #1f2937;
      color: var(--text-main);
    }

    body.dark-mode .share-btn:hover {
      background: #020617;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.9);
    }

    .copy-notice {
      font-size: 0.78rem;
      margin-top: 4px;
      color: var(--text-muted);
      min-height: 14px;
    }

    .copy-notice.success {
      color: #16a34a;
    }

    .copy-notice.error {
      color: #dc2626;
    }

    .info-section {
      margin-top: 18px;
      background: var(--card-bg);
      border-radius: 22px;
      padding: 16px 16px 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .info-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .info-subtitle {
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      font-size: 0.8rem;
    }

    @media (max-width: 900px) {
      .info-grid {
        grid-template-columns: 1fr;
      }
    }

    .info-card {
      background: rgba(248, 250, 252, 0.8);
      border-radius: 18px;
      padding: 11px 12px;
      border: 1px solid rgba(226, 232, 240, 0.9);
    }

    body.dark-mode .info-card {
      background: rgba(15, 23, 42, 0.98);
      border-color: #020617;
    }

    .info-card h3 {
      font-size: 0.9rem;
      margin-bottom: 6px;
    }

    .info-card ul {
      margin-left: 16px;
      margin-top: 4px;
      display: grid;
      gap: 2px;
    }

    .info-card li {
      margin-bottom: 1px;
    }

    footer {
      margin-top: 10px;
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <div class="theme-toggle-wrapper">
        <button id="themeToggle" class="theme-toggle" type="button">
          <span class="icon">üåô</span>
          <span class="label">Dark mode</span>
        </button>
      </div>
      <img src="logo.png.png" alt="CalorieFlow logo" class="app-logo" />
      <h1>CalorieFlow</h1>
      <p>Smart calorie calculator for your daily health journey.</p>
    </header>

    <main>
      <section class="calculator-card">
        <!-- FORM SECTION -->
        <section class="form-section">
          <h2 class="section-title">Your Details</h2>
          <form id="calorieForm" novalidate>
            <div class="form-grid">
              <!-- Gender -->
              <div class="form-group">
                <label>Gender</label>
                <div class="inline-options">
                  <label class="chip-option">
                    <input type="radio" name="gender" value="male" />
                    <span>Male</span>
                  </label>
                  <label class="chip-option">
                    <input type="radio" name="gender" value="female" />
                    <span>Female</span>
                  </label>
                </div>
              </div>

              <!-- Age -->
              <div class="form-group">
                <label for="age">Age</label>
                <input
                  type="number"
                  id="age"
                  min="10"
                  max="100"
                  placeholder="Years (10 - 100)"
                />
              </div>

              <!-- Height -->
              <div class="form-group">
                <label for="height">Height</label>
                <input
                  type="number"
                  id="height"
                  min="100"
                  max="250"
                  placeholder="Height in cm (100 - 250)"
                />
              </div>

              <!-- Weight -->
              <div class="form-group">
                <label for="weight">Weight</label>
                <input
                  type="number"
                  id="weight"
                  min="30"
                  max="250"
                  placeholder="Weight in kg (30 - 250)"
                />
              </div>

              <!-- Activity Level -->
              <div class="form-group">
                <label for="activity">Activity Level</label>
                <select id="activity">
                  <option value="">Select your activity</option>
                  <option value="sedentary">
                    Sedentary (little or no exercise)
                  </option>
                  <option value="light">
                    Lightly active (1‚Äì3 days per week)
                  </option>
                  <option value="moderate">
                    Moderately active (3‚Äì5 days per week)
                  </option>
                  <option value="very">
                    Very active (6‚Äì7 days per week)
                  </option>
                  <option value="super">
                    Super active (intense training)
                  </option>
                </select>
              </div>

              <!-- Goal -->
              <div class="form-group">
                <label>Goal</label>
                <div class="inline-options">
                  <label class="chip-option">
                    <input type="radio" name="goal" value="lose" />
                    <span>Lose weight</span>
                  </label>
                  <label class="chip-option">
                    <input type="radio" name="goal" value="maintain" />
                    <span>Maintain weight</span>
                  </label>
                  <label class="chip-option">
                    <input type="radio" name="goal" value="gain" />
                    <span>Gain weight</span>
                  </label>
                </div>
              </div>
            </div>

            <button type="submit" class="btn-primary">
              <span class="icon">‚ö°</span>
              <span>Calculate Calories</span>
            </button>

            <button type="button" id="resetButton" class="btn-secondary">
              Reset all fields
            </button>

            <div id="errorMessage" class="error-message"></div>
          </form>
        </section>

        <!-- RESULTS SECTION -->
        <section class="results-section">
          <h2 class="section-title">Your Results</h2>
          <div id="resultBox" class="result-box">
            <div class="result-tag">
              <span>Estimated values based on your data</span>
            </div>

            <div class="result-row">
              <div class="result-label">Basal Metabolic Rate (BMR)</div>
              <div class="result-value" id="bmrValue">‚Äî kcal</div>
            </div>

            <div class="result-row">
              <div class="result-label">Maintenance Calories</div>
              <div class="result-value" id="maintenanceValue">‚Äî kcal</div>
            </div>

            <div class="result-row">
              <div class="result-label">Target Calories</div>
              <div class="result-value" id="goalValue">‚Äî kcal</div>
            </div>

            <p class="result-note" id="goalDescription">
              Fill in your details, choose your activity level and goal, then
              click "Calculate Calories" to see your personalized results.
            </p>

            <div class="results-grid">
              <!-- Protein card -->
              <div class="result-card">
                <div class="result-card-title">Protein</div>
                <div class="result-large" id="proteinValue">‚Äî g/day</div>
                <div class="macro-range">
                  Around 1.6‚Äì2.2 g per kg of body weight.
                </div>
              </div>

              <!-- Fats card -->
              <div class="result-card">
                <div class="result-card-title">Fats</div>
                <div class="result-large" id="fatValue">‚Äî g/day</div>
                <div class="macro-range">
                  Around 0.8‚Äì1.0 g per kg of body weight.
                </div>
              </div>

              <!-- Carbs card -->
              <div class="result-card">
                <div class="result-card-title">Carbs</div>
                <div class="result-large" id="carbValue">‚Äî g/day</div>
                <div class="macro-range">
                  Remaining calories after protein & fats.
                </div>
              </div>

              <!-- Split card -->
              <div class="result-card">
                <div class="result-card-title">Suggested daily split</div>
                <div class="split-row">
                  <span>Breakfast</span>
                  <span id="breakfastValue">‚Äî kcal</span>
                </div>
                <div class="split-row">
                  <span>Lunch</span>
                  <span id="lunchValue">‚Äî kcal</span>
                </div>
                <div class="split-row">
                  <span>Dinner</span>
                  <span id="dinnerValue">‚Äî kcal</span>
                </div>
                <div class="split-row">
                  <span>Snacks</span>
                  <span id="snacksValue">‚Äî kcal</span>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- SHARE SECTION -->
      <section class="share-section">
        <h2 class="share-title">Share CalorieFlow with friends</h2>
        <p class="share-text">
          Help others track their calories too. Share this calculator with your friends, clients, or social media followers.
        </p>
        <div class="share-buttons">
          <button id="shareCopy" type="button" class="share-btn">
            <span class="icon">üìã</span>
            <span>Copy link</span>
          </button>

          <a id="shareWhatsApp" href="#" target="_blank" rel="noopener noreferrer" class="share-btn">
            <span class="icon">üü¢</span>
            <span>Share on WhatsApp</span>
          </a>

          <a id="shareTwitter" href="#" target="_blank" rel="noopener noreferrer" class="share-btn">
            <span class="icon">ùïè</span>
            <span>Share on X / Twitter</span>
          </a>
        </div>
        <div id="copyNotice" class="copy-notice" aria-live="polite"></div>
      </section>

      <!-- INFO SECTION -->
      <section class="info-section">
        <h2 class="info-title">How to use CalorieFlow effectively</h2>
        <p class="info-subtitle">
          This short guide explains how to read your results and use them in a healthy,
          realistic way. It is not medical advice, but a starting point for better habits.
        </p>

        <div class="info-grid">
          <article class="info-card">
            <h3>1. Understand your maintenance calories</h3>
            <p>
              Your maintenance calories are the amount of energy your body needs to keep your
              current weight with your current activity level.
            </p>
            <ul>
              <li>Eating close to this value ‚Üí weight stays roughly stable.</li>
              <li>Going far above for long periods ‚Üí weight gain.</li>
              <li>Going far below for long periods ‚Üí weight loss, but also fatigue.</li>
            </ul>
          </article>

          <article class="info-card">
            <h3>2. Safe fat loss strategy</h3>
            <p>
              For most people, a moderate calorie deficit is safer and easier to maintain than
              aggressive diets.
            </p>
            <ul>
              <li>Target a deficit of about 15‚Äì20% below maintenance.</li>
              <li>Prioritise protein and whole foods to stay full.</li>
              <li>
                Combine calorie control with walking and resistance training.
              </li>
            </ul>
          </article>

          <article class="info-card">
            <h3>3. Building muscle & strength</h3>
            <p>
              To gain quality weight, focus on progressive training and a small calorie surplus.
            </p>
            <ul>
              <li>Eat around 5‚Äì15% above maintenance calories.</li>
              <li>
                Train with weights 2‚Äì4 times per week, focusing on compound movements.
              </li>
              <li>Keep protein high and sleep at least 7 hours per night.</li>
            </ul>
          </article>
        </div>
      </section>

      <footer>
        This tool is for educational purposes only and does not replace medical
        or professional nutrition advice.
      </footer>
    </main>
  </div>

  <script>
    const STORAGE_KEY_FORM = "calorieflow_form_v1";
    const STORAGE_KEY_THEME = "calorieflow_theme_v1";

    const form = document.getElementById("calorieForm");
    const errorMessage = document.getElementById("errorMessage");
    const resultBox = document.getElementById("resultBox");
    const bmrValueEl = document.getElementById("bmrValue");
    const maintenanceValueEl = document.getElementById("maintenanceValue");
    const goalValueEl = document.getElementById("goalValue");
    const goalDescriptionEl = document.getElementById("goalDescription");
    const proteinValueEl = document.getElementById("proteinValue");
    const fatValueEl = document.getElementById("fatValue");
    const carbValueEl = document.getElementById("carbValue");
    const breakfastValueEl = document.getElementById("breakfastValue");
    const lunchValueEl = document.getElementById("lunchValue");
    const dinnerValueEl = document.getElementById("dinnerValue");
    const snacksValueEl = document.getElementById("snacksValue");
    const resetButton = document.getElementById("resetButton");
    const themeToggleBtn = document.getElementById("themeToggle");

    const shareCopyBtn = document.getElementById("shareCopy");
    const shareWhatsAppLink = document.getElementById("shareWhatsApp");
    const shareTwitterLink = document.getElementById("shareTwitter");
    const copyNotice = document.getElementById("copyNotice");

    function clearError() {
      errorMessage.style.display = "none";
      errorMessage.textContent = "";
    }

    function showError(msg) {
      errorMessage.textContent = msg;
      errorMessage.style.display = "block";
    }

    function saveFormState() {
      const data = {
        gender: form.querySelector('input[name="gender"]:checked')?.value || "",
        goal: form.querySelector('input[name="goal"]:checked')?.value || "",
        age: document.getElementById("age").value || "",
        height: document.getElementById("height").value || "",
        weight: document.getElementById("weight").value || "",
        activity: document.getElementById("activity").value || "",
      };
      localStorage.setItem(STORAGE_KEY_FORM, JSON.stringify(data));
    }

    function loadFormState() {
      const raw = localStorage.getItem(STORAGE_KEY_FORM);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        if (data.age) document.getElementById("age").value = data.age;
        if (data.height) document.getElementById("height").value = data.height;
        if (data.weight) document.getElementById("weight").value = data.weight;
        if (data.activity) document.getElementById("activity").value = data.activity;
        if (data.gender) {
          const g = form.querySelector('input[name="gender"][value="' + data.gender + '"]');
          if (g) g.checked = true;
        }
        if (data.goal) {
          const g2 = form.querySelector('input[name="goal"][value="' + data.goal + '"]');
          if (g2) g2.checked = true;
        }
      } catch (e) {
        console.error("Failed to load saved form", e);
      }
    }

    function applyTheme(theme) {
      if (theme === "dark") {
        document.body.classList.add("dark-mode");
        themeToggleBtn.querySelector(".icon").textContent = "‚òÄÔ∏è";
        themeToggleBtn.querySelector(".label").textContent = "Light mode";
      } else {
        document.body.classList.remove("dark-mode");
        themeToggleBtn.querySelector(".icon").textContent = "üåô";
        themeToggleBtn.querySelector(".label").textContent = "Dark mode";
      }
    }

    function loadTheme() {
      const saved = localStorage.getItem(STORAGE_KEY_THEME);
      if (saved === "dark" || saved === "light") {
        applyTheme(saved);
      } else {
        const prefersDark = window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        applyTheme(prefersDark ? "dark" : "light");
      }
    }

    function toggleTheme() {
      const isDark = document.body.classList.contains("dark-mode");
      const newTheme = isDark ? "light" : "dark";
      applyTheme(newTheme);
      localStorage.setItem(STORAGE_KEY_THEME, newTheme);
    }

    function resetFormAndResults() {
      form.reset();
      document.getElementById("activity").value = "";

      clearError();
      localStorage.removeItem(STORAGE_KEY_FORM);

      bmrValueEl.textContent = "‚Äî kcal";
      maintenanceValueEl.textContent = "‚Äî kcal";
      goalValueEl.textContent = "‚Äî kcal";
      proteinValueEl.textContent = "‚Äî g/day";
      fatValueEl.textContent = "‚Äî g/day";
      carbValueEl.textContent = "‚Äî g/day";
      breakfastValueEl.textContent = "‚Äî kcal";
      lunchValueEl.textContent = "‚Äî kcal";
      dinnerValueEl.textContent = "‚Äî kcal";
      snacksValueEl.textContent = "‚Äî kcal";

      goalDescriptionEl.textContent =
        'Fill in your details, choose your activity level and goal, then click "Calculate Calories" to see your personalized results.';

      resultBox.classList.remove("visible");
    }

    // SHARE FUNCTIONS
    function setupShareLinks() {
      const url = window.location.href;
      const text =
        "Check out CalorieFlow ‚Äì a smart calorie calculator for your daily health journey:";
      const encodedUrl = encodeURIComponent(url);
      const encodedText = encodeURIComponent(text);

      if (shareWhatsAppLink) {
        shareWhatsAppLink.href = `https://wa.me/?text=${encodedText}%20${encodedUrl}`;
      }

      if (shareTwitterLink) {
        shareTwitterLink.href = `https://twitter.com/intent/tweet?text=${encodedText}&url=${encodedUrl}`;
      }
    }

    function showCopyMessage(message, type) {
      if (!copyNotice) return;
      copyNotice.textContent = message;
      copyNotice.classList.remove("success", "error");
      if (type) copyNotice.classList.add(type);
      setTimeout(() => {
        copyNotice.textContent = "";
        copyNotice.classList.remove("success", "error");
      }, 2200);
    }

    async function handleCopyLink() {
      const url = window.location.href;
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(url);
          showCopyMessage("Link copied to clipboard!", "success");
        } else {
          // fallback
          const ok = window.prompt("Copy this link:", url);
          if (ok !== null) {
            showCopyMessage("Link shown. Copy it manually.", "success");
          }
        }
      } catch (err) {
        console.error("Copy failed", err);
        showCopyMessage("Could not copy link. Please copy it manually.", "error");
      }
    }

    // Clear errors + ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ÿßŸÑÿ™ÿπÿØŸäŸÑ
    form.querySelectorAll("input, select").forEach((el) => {
      el.addEventListener("input", () => {
        clearError();
        saveFormState();
      });
      el.addEventListener("change", () => {
        clearError();
        saveFormState();
      });
    });

    resetButton.addEventListener("click", resetFormAndResults);
    themeToggleBtn.addEventListener("click", toggleTheme);

    if (shareCopyBtn) {
      shareCopyBtn.addEventListener("click", handleCopyLink);
    }

    form.addEventListener("submit", function (event) {
      event.preventDefault();
      clearError();

      const gender = form.querySelector('input[name="gender"]:checked');
      const goal = form.querySelector('input[name="goal"]:checked');
      const age = Number(document.getElementById("age").value);
      const height = Number(document.getElementById("height").value);
      const weight = Number(document.getElementById("weight").value);
      const activity = document.getElementById("activity").value;

      if (!gender) {
        showError("Please select your gender.");
        return;
      }
      if (!age || age < 10 || age > 100) {
        showError("Please enter a valid age between 10 and 100.");
        return;
      }
      if (!height || height < 100 || height > 250) {
        showError("Please enter a valid height between 100 and 250 cm.");
        return;
      }
      if (!weight || weight < 30 || weight > 250) {
        showError("Please enter a valid weight between 30 and 250 kg.");
        return;
      }
      if (!activity) {
        showError("Please select your activity level.");
        return;
      }
      if (!goal) {
        showError("Please select your goal.");
        return;
      }

      // BMR (Mifflin-St Jeor)
      let bmr;
      if (gender.value === "male") {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }

      let activityFactor = 1.2;
      switch (activity) {
        case "sedentary":
          activityFactor = 1.2;
          break;
        case "light":
          activityFactor = 1.375;
          break;
        case "moderate":
          activityFactor = 1.55;
          break;
        case "very":
          activityFactor = 1.725;
          break;
        case "super":
          activityFactor = 1.9;
          break;
      }

      const maintenanceCalories = bmr * activityFactor;

      let suggestedCalories = maintenanceCalories;
      let description = "";

      if (goal.value === "lose") {
        suggestedCalories = maintenanceCalories * 0.85;
        description =
          "To lose weight, a gentle calorie deficit is recommended. These calories may help you lose weight gradually while maintaining energy for daily activities.";
      } else if (goal.value === "maintain") {
        suggestedCalories = maintenanceCalories;
        description =
          "To maintain your current weight, try to stay close to this calorie range and keep a consistent activity level.";
      } else if (goal.value === "gain") {
        suggestedCalories = maintenanceCalories * 1.15;
        description =
          "To gain weight, especially muscle mass, a slight calorie surplus combined with strength training can be effective.";
      }

      const bmrRounded = Math.round(bmr);
      const maintenanceRounded = Math.round(maintenanceCalories);
      const suggestedRounded = Math.round(suggestedCalories);

      // Macros
      const proteinLow = weight * 1.6;
      const proteinHigh = weight * 2.2;
      const proteinMid = (proteinLow + proteinHigh) / 2;

      const fatLow = weight * 0.8;
      const fatHigh = weight * 1.0;
      const fatMid = (fatLow + fatHigh) / 2;

      const caloriesFromProtein = proteinMid * 4;
      const caloriesFromFat = fatMid * 9;
      let caloriesForCarbs = suggestedRounded - (caloriesFromProtein + caloriesFromFat);
      if (caloriesForCarbs < 0) caloriesForCarbs = 0;
      const carbs = caloriesForCarbs / 4;

      // Meal split: 30 / 40 / 25 / 5
      const breakfast = suggestedRounded * 0.3;
      const lunch = suggestedRounded * 0.4;
      const dinner = suggestedRounded * 0.25;
      const snacks = suggestedRounded * 0.05;

      // Display
      bmrValueEl.textContent = bmrRounded + " kcal";
      maintenanceValueEl.textContent = maintenanceRounded + " kcal";
      goalValueEl.textContent = suggestedRounded + " kcal";
      goalDescriptionEl.textContent = description;

      proteinValueEl.textContent =
        Math.round(proteinLow) + "‚Äì" + Math.round(proteinHigh) + " g/day";
      fatValueEl.textContent =
        Math.round(fatLow) + "‚Äì" + Math.round(fatHigh) + " g/day";
      carbValueEl.textContent = "‚âà " + Math.round(carbs) + " g/day";

      breakfastValueEl.textContent = Math.round(breakfast) + " kcal";
      lunchValueEl.textContent = Math.round(lunch) + " kcal";
      dinnerValueEl.textContent = Math.round(dinner) + " kcal";
      snacksValueEl.textContent = Math.round(snacks) + " kcal";

      resultBox.classList.add("visible");
      resultBox.scrollIntoView({ behavior: "smooth", block: "nearest" });
    });

    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿµŸÅÿ≠ÿ©
    loadTheme();
    loadFormState();
    setupShareLinks();
  </script>
</body>
</html>
